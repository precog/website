<!DOCTYPE html>
<html>
    <head>
        <title>Queries</title>
        <link rel="stylesheet" type="text/css" href="css/innerpage.css">
        <link rel="shortcut icon" href="http://precog.io/images/icon-favicon.ico" mce_href="http://precog.io/images/icon-favicon.ico"/>
        <!--[if (gte IE 6)&(lte IE 8)]>
                <script type="text/javascript" src="js/selectivizr.js"></script>
                <noscript><link rel="stylesheet" href="[fallback css]" /></noscript>
        <![endif]-->
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
        <script type="text/javascript" src="js/default.js"></script>
        <script type="text/javascript" src="js/jquery.console.js"></script>
        <script type="text/javascript" src="js/console.js"></script>
    </head>
    <body>
        <div id="contact-us">
            <a href="contact-us.html"></a>
        </div>
        <div id="support">
            <a href="http://support.precog.io/"></a>
        </div>
        <div id="background-top">
            <div id="header">
                <div id="header-logo">
                    <a href="./index.html"><img alt="precog" src="images/logo-precog.png"></a>
                </div>
                <div id="header-menu">
                    <ul>
                        <li><a href="how-it-works.html">how it works</a></li>
                        <li><a href="pricing.html">pricing</a></li>
                        <li><a href="add-ons.html">add-ons</a></li>
                        <li><a href="developer-center.html">dev center</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="background-main1">
            <div id="body">
                <div id="body-navbar">
                    <a class="bodynav-devcenter" href="developer-center.html">dev center</a>
                    <a class="bodynav-support" href="http://support.precog.io/">support</a>
                    <a class="bodynav-status" href="http://status.precog.io/">status</a>
                </div>
                <div id="body-content-left-dev-cntr">
                    <h1 class="body-title">QUERIES</h1>
                    <p>Precog lets you do very sophisticated, custom analytical and statistical queries when you need to. Precog implements the open standard
                      <a href="http://whatisquirrel.com">Quirrel</a>, which is a query language designed specifically for analytics and statistics on large, multi-structured data sets.</p>
                      
                    <p>If the analysis you want is not already packaged into the client library you are using, then it's a good bet you can perform it with Quirrel.
                      All the client libraries implement <em>all of their functionality</em> in terms of simple Quirrel queries.</p>
                      
                    <p>Below you will find an interactive tutorial that lets you learn and experiment with Quirrel at the same time. After you've gone through the
                      tutorial, please check out the <a href="console.html">standalone console</a>.</p>
                      
                    <p>If you want more information 
                      on Quirrel, be sure to visit the <a href="http://whatisquirrel.com">official website</a> of the standard.</p>
                      
                    <h2>JSON</h2>
                    <p>Quirrel has native support for JSON. You can create strings, numbers, booleans, arrays, and objects just like you do in JavaScript.</p>
                    <div class="console-tutorials console" id="console-json"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-json-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-json', '{name: "John", age: 29, gender: "male"}')</script>

                    <div class="console-tutorials console" id="console-bool"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-bool-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-bool', 'true')</script>

                    <div class="console-tutorials console" id="console-string"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-string-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-string', '"hello world"')</script>
                    <div class="body-section-breaker">
                    </div>
                    <h2>NUMBERS</h2>
                    <p>Quirrel is designed for analytics, so it has very good support for math. In fact, you can use Quirrel as a calculator!</p>

                    <div class="console-tutorials console" id="console-sum"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-sum-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-sum', '5 + 2')</script>

                    <div class="console-tutorials console" id="console-mul"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-mul-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-mul', '8 * 2')</script>


                    <p>Quirrel has an extensive built-in library of mathematical functions. Check the reference guide to see them all.</p>
                    <div class="body-section-breaker">
                    </div>
                    <h2>BOOLEANS</h2>
                    <p>Quirrel supports equality and inequality operators, which result in boolean values. These operators are often used to filter sets of data (a topic covered later).</p>
                    <div class="console-tutorials console" id="console-bigger"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-bigger-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-bigger', '5 > 2')</script>

                    <div class="console-tutorials console" id="console-different"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-different-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-different', '"foo" != "foo"')</script>


                    <div class="body-section-breaker">
                    </div>
                    <p>The full list of equality/inequality operators includes = (equal), != (not equal), < (less than), > (greater than), and variants like <= and >=.</p>

                    <h2>VARIABLES</h2>
                    <p>You can store intermediate results in variables to make your queries more readable. The final expression determines what is returned by the query.</p>
                    <div class="console-tutorials console" id="console-total"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-total-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-total', 'total := 2 + 1\ntotal * 3')</script>

                    <div class="console-tutorials console" id="console-square"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-square-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-square', 'num := 4\nsquare := num * num\nsquare - 1')</script>
                    <div class="body-section-breaker">
                    </div>
                    <h2>LOADING DATA</h2>
                    <p>The most basic query you can do is to retrieve raw data. To do this, use the <em>load</em> function, and specify the path to load data from.</p>
                    <div class="console-tutorials console" id="console-load"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-load-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-load', 'payments := load(//payments)\npayments')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The load function returns all the data stored at the specified path, even if the values have differing types or schemas.</p>
                    <h2>FILTERED DESCENT</h2>
                    <p>Quirrel has direct support for JavaScript's <em>object descent</em> and <em>array descent</em> operators. These operators allow you to descend into sets containing objects or arrays.</p>
                    <div class="console-tutorials console" id="console-jsproperty"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-jsproperty-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-jsproperty', 'payments := load(//payments)\npayments.date')</script>

                    <div class="console-tutorials console" id="console-arrayaccess"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-arrayaccess-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-arrayaccess', 'payments := load(//payments)\npayments.recipients[0]')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The descent operators filter the data set to those items that contain the specified field or array index.</p>
                    <h2>REDUCTIONS</h2>
                    <p>Quirrel can reduce sets of data into a single value. There are many built-in reductions.</p>
                    <div class="console-tutorials console" id="console-sumcount"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-sumcount-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-sumcount', 'count(load(//payments))')</script>

                    <div class="console-tutorials console" id="console-summean"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-summean-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-summean', 'mean(load(//payments).amount)')</script>

                    <div class="console-tutorials console" id="console-sumsum"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-sumsum-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-sumsum', 'sum(load(//payments).amount)')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>See the Quirrel reference guide for documentation on all supported reductions.</p>
                    <h2>SETS OF EVENTS</h2>
                    <p>In Quirrel, every expression is a set of events. An event is just something that has an identity and a JSON value. Every value you store gets its own unique identity. Identities are hidden (you'll never see them), but they are used internally by Quirrel.</p>
                    <div class="body-section-breaker">
                    </div>
                    <h2>IDENTITY MATCHING</h2>
                    <p>All functions and operators in Quirrel operate on sets of events, not values. When you add two sets (for example), Quirrel finds the events whose identities match, and adds their values, to produce a new set.</p>
                    <div class="console-tutorials console" id="console-identity"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-identity-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-identity', 'orders := load(//orders)\norders.subTotal + orders.subTotal * orders.taxRate + orders.shipping + orders.handling')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The set-oriented nature of Quirrel lets you perform bulk operations without having to iterate over elements. This property is also what makes it possible to efficiently distribute Quirrel queries across clusters of machines.</p>
                    <h2>VALUES</h2>
                    <p>Quirrel implicitly converts values like "0.10" or "male" into sets containing a single event. These events have so-called <em>bottom identity</em>, which matches against all identities.</p>
                    <div class="console-tutorials console" id="console-values"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-values-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-values', 'payments := load(//payments)\npayments.amount * 0.10')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>In this example, all values in the _payments.amount_ set are multiplied by 0.10, because the 0.10 event has bottom identity and therefore matches with all events in the "payments.amount" set.</p>
                    <h2>FILTERING</h2>
                    <p>Quirrel has a "where" operator which allows you to filter one set by another set of boolean values.</p>
                    <div class="console-tutorials console" id="console-filter"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-filter-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-filter', 'payments := load(//payments)\ncount(payments where payments.amount > 10.00)')</script>

                    <div class="console-tutorials console" id="console-where"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-where-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-where', 'users := load(//users)\nsegment := users.age > 19 & users.age < 53 & users.income > 60000\ncount(users where segment)')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The <em>where</em> operator in Quirrel is not magical -- it's simply a function from two sets (one of which is a boolean set) to one set. You can store the boolean set in a variable if you want to use it multiple times.</p>
                    <h2>CHAINING</h2>
                    <p>Quirrel lets you chain expressions together without any limitations. This lets you easily perform multi-step analytical queries.</p>
                    <div class="console-tutorials console" id="console-chaining"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-chaining-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-chaining', 'pageViews := load(//pageViews)\nbound := 1.5 * stdDev(pageViews.duration)\navg := mean(pageViews.duration)\nlongPageViews := pageViews where pageViews.duration > (avg + bound)\nlongPageViews.userId')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>This query identifies users who spend an unusually long amount of time viewing a page.</p>
                    <h2>USER-DEFINED FUNCTIONS</h2>
                    <p>Quirrel lets you create user-defined functions, which map from one or more values to sets. These functions are often used to perform analytical queries on a group of related values. They can also be used to factor out logic that's common across different queries.</p>
                    <div class="console-tutorials console" id="console-userfunction">
                        <div class="jquery-console-inner jquery-console-nofocus">
                            <div class="jquery-console-prompt-box">
                                <span class="jquery-console-prompt-label">       | </span><span class="jquery-console-prompt">pageViews := pageViewsForUser('userId) := pageViews where pageViews.userId = 'userId</span>
                            </div>
                        </div>
                    </div>
                    <div class="body-section-breaker">
                    </div>
                    <p>This function returns all page views for a given userId.</p>
                    <h2>FULLY-APPLIED FUNCTIONS</h2>
                    <p>You can call functions with parameters. This has the same effect as substituting the parameters into the body of the function.</p>
                    <div class="console-tutorials console" id="console-fullyapplied"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-fullyapplied-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-fullyapplied', 'pageViews := load(//pageViews)\npageViewsForUser(\'userId) := pageViews where pageViews.userId = \'userId\npageViewsForUser(12345)')</script>
                    <div class="body-section-breaker">
                    </div>
                    <h2>PARTIALLY-APPLIED FUNCTIONS, PART I</h2>
                    <p>In many cases, Quirrel knows how to compute the range of values for a parameter. If you call the function without supplying a value, Quirrel will evaluate the function at all possible values and merge the results into a single set.</p>
                    



                    <div class="console-tutorials console" id="console-partialfunction1"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-partialfunction1-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-partialfunction1', 'pageViews := load(//pageViews)\npageViewsForUser(\'userId) := {userId: \'userId, meanPageView: mean(pageViews.duration where pageViews.userId = \'userId)}\npageViewsForUser')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>This query results in average page view durations for all users.</p>
                    <h2>PARTIALLY-APPLIED FUNCTIONS, PART II</h2>
                    <p>A common idiom in Quirrel is to save the parameters of a function into an object that contains both the parameters, and the desired calculation.</p>
                    <div class="console-tutorials console" id="console-partialfunction2"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-partialfunction2-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-partialfunction2', 'clicks := load(//clicks)\nviews  := load(//views)\nclickthroughRate(\'page) := {page: \'page, ctr: count(clicks where clicks.pageId = \'page) / count(views where views.pageId = \'page)}\nclickthroughRate')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The final set contains objects that have a <em>day</em> field and a <em>ctr</em> field (the clickthrough rate on the specified day).</p>
                    <h2>AUGMENTATION</h2>
                    <p>You can easily add more fields to objects, or more elements to arrays, with the <em>with</em> operator.</p>
                    <div class="console-tutorials console" id="console-augmentation"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-augmentation-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-augmentation', 'clicks := load(//clicks)\nclicksWithDays := clicks with {day: (std :: time :: dayOfYear(clicks.timeString)) }\nclicksWithDays')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>In this query, a "day" field is added to the click objects.</p>
                    <h2>JOINS</h2>
                    <p>The most complicated operator in Quirrel is the relate operator 'relate', which joins together sets that don't share identities, and allows you to perform operations on the joined sets.</p>
                    <div class="console-tutorials console" id="console-join"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-join-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-join', 'customers := load(//customers)\norders := load(//orders)\nfractionForUser(\'userId) :=\n  customers where customers.userId = \'userId ~ orders where orders.userId = \'userId\n  orders.total / customers.income\nfractionForUser')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The above query relates the customers and orders sets by their userId field, then computes the total order cost over income. The relate operator is similar to SQL's JOIN operator, but more powerful.</p>
                    <h2>SELF-JOINS</h2>
                    <p>Quirrel makes it easy to do self-joins by providing the 'new' operator, which conceptually creates a copy of a set, but with new identities. The new set is not related to the original set (but you can relate it with the relate operator).</p>
                    <div class="console-tutorials console" id="console-selfjoin"></div>
                    <div class="console-execute">
                        <div class="console-execute-button button-top-adjust" id="console-selfjoin-execute-button">
                        </div>
                    </div>
                    <script type="text/javascript">buildConsole('console-selfjoin', 'users  := load(//users)\nusers\' := new users\nusers ~ users\'\n{ location: users.location.state,  income: users.income }')</script>
                    <div class="body-section-breaker">
                    </div>
                    <p>The above query produces a cross-product of all states and income levels.</p>
                    <h2>THAT'S IT!</h2>
                    <p>Quirrel has many built-in functions that help you do analytics. However, you now know all there is to know about Quirrel syntax and semantics.</p>
                    <p>Check out the analytics gallery to see how Quirrel makes short work of even very hard analytical problems!</p>
                    
                </div>
                <div id="body-content-right-dev-cntr">
                    <div id="content-right-menu">
                        <ul>
                            <li><a href="developer-center.html">overview</a></li>
                            <li><a href="console.html">console</a></li>
                            <li><a href="queries.html">queries</a></li>
                            <li class="dev-center-api-docs"><a href="api-documentation.html">api documentation</a></li>
                                <!--
                                <ul>
                                    <li class="dev-center-api-doc"><a href="">doc 1</a></li>
                                </ul>
                                -->
                            <li><a href="developer-center-addons.html">add-ons</a></li>
                        </ul>
                    </div>
                </div>
                <div class="atrib-clear-left">
                </div>
            </div>
        </div>
        <div id="background-footer">
            <div id="footer">
                <div id="footer-menu">
                    <ul>
                        <li>Precog</li>
                        <li><a href="about.html">about</a></li>
                        <li><a href="contact-us.html">contact</a></li>
                        <li><a href="jobs.html">jobs</a></li>
                    </ul>
                     <ul>
                        <li>Business</li>
                        <li><a href="why-precog.html">why precog?</a></li>
                        <li><a href="success-stories.html">success stories</a></li>
                        <li><a href="dev-partner.html">dev partners</a></li>
                        <li><a href="add-on-partner.html">add-on partners</a></li>
                        <li><a href="news-and-events.html">news & events</a></li>
                        <li><a href="blog.html">blog</a></li>
                    </ul>
                     <ul>
                        <li>Platform</li>
                        <li><a href="how-it-works.html">how it works?</a></li>
                        <li><a href="pricing.html">pricing</a></li>
                        <li><a href="add-ons.html">add-ons</a></li>
                    </ul>
                     <ul>
                        <li>Resources</li>
                        <li><a href="developer-center.html">dev center</a></li>
                        <li><a href="http://support.precog.io/">support</a></li>
                        <li><a href="http://status.precog.io/">status</a></li>
                    </ul>
                </div>
                <div id="phone-number">
                    <p>(888) 673-9958</p>
                </div>
                <div id="icon-facebook">
                    <a href="http://www.facebook.com/pages/Precog/136686693120257?sk=wall" target="_blank"></a>
                </div>
                <div id="icon-twitter">
                    <a href="https://twitter.com/#!/@Precog1" target="_blank"></a>
                </div>
                <div id="copyrights">
                    <p>Copyright &copy; 2012 ReportGrid, Inc. All Rights Reserved</p>
                </div>
            </div>
        </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-589893-15']);
  _gaq.push(['_setDomainName', 'precog.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
    </body>
</html>
