<!DOCTYPE HTML>
<html>
  <head>
    
    <title>ReportGrid -- Demo</title>
    <link type="text/css" rel="stylesheet" href="css/index.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type="text/javascript">
      var rpxJsHost = (("https:" == document.location.protocol) ? "https://" : "http://static.");
      document.write(unescape("%3Cscript src='" + rpxJsHost +
    "rpxnow.com/js/lib/rpx.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      RPXNOW.overlay = true;
      RPXNOW.language_preference = 'en';
    </script>
    <script src="reportgrid-core.js?tokenId=A3BC1539-E8A9-4207-BB41-3036EC2C6E6D&amp;analyticsServer=http%3A%2F%2Fapi.reportgrid.com%2Fservices%2Fanalytics%2Fv0%2F&amp;useJsonp=true" type="text/javascript"></script>
    <script src="http://static.reportgrid.com/api/js/v1/reportgrid-viz.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="top">
    
      <div class="top-center">
        <div id="header">
          <a href="index.html"><div class="clickable" id="logo"></div></a>
          <div id="login-button" class="clickable"><a class="rpxnow" onclick="return false;"
          href="https://reportgrid.rpxnow.com/openid/v2/signin?token_url=http%3A%2F%2Freportgrid.com%2Flogin.html"><img class="clickable rollover" src="images/loginbuttonreg.png" /></a></div>
          <div id="nav-bar">
            <div class="button clickable" id="demo-button"><a href="demo.html"><img src="images/demosel.png" /></a></div>
            <div class="button clickable" id="features-button"><a href="features.html"><img class="clickable rollover" src="images/featuresreg.png" /></a></div>
            <div class="button clickable" id="api-button"><a href="api.html"><img class="clickable rollover" src="images/apireg.png" /></a></div>
            <div class="button clickable" id="why-button"><a href="why.html"><img class="clickable rollover" src="images/whyreg.png" /></a></div>
            <div class="button clickable" id="pricing-button"><a href="pricing.html"><img class="clickable rollover" src="images/pricingreg.png" /></a></div>
            <div class="button clickable" id="about-button"><a href="about.html"><img class="clickable rollover" src="images/aboutreg.png" /></a></div>
          </div>
        </div>
      
      
        <div id="center-panel">
          <div id="demo-panel">
            <p class="header">Dashboard</p>
            <br />
            <div class="content-block">
              <div id="send-random-data">Send Events</div>

              
            </div>
            <div class="content-block">
              <p class="header">Pivot Table</p>
              <div id="pivot-table-demo">
            		<div id="pivot-table-dashboard">
            		  <div class="pivot-table-selectors">
            		    <div class="selector-block">
              		    <div class="pivot-table-field">
                		    <div class="dashboard-field"><h2>Path </h2>
                  		  	<input id="path-input" type="text"  value="/adv/"/> <input id="get-properties-button" type="submit" value="Get Properties" />
                  		  </div>
                  		</div>
                  		<div class="pivot-table-field">
                  		  <div class="dashboard-field"><h2>Event Name <h2> 
                  		    <select id="event-selector">
                  		      <option>select</option>
                  		    </select>
                  		  </div>
                  		</div>
                  	</div>
                  	<div class="pivot-table-property-selectors-parent">
                  	  <div class="properties-selector-header-container">
                  	    <h3>Properties</h3>
                  	  </div>
                		  <div class="properties-selectors dashboard-field">
                		    <div class="property-selector-container"><h2>Columns </h2>
                		      <select id="column-selector" class="property-selector">
                		        <option>select</option>
                		      </select>
                		    </div>
                		    <div class="property-selector-container"><h2>Rows </h2>
                		      <select  id="row-selector" class="property-selector">
                		      	<option>select</option>
                		      </select>
                		    </div>
              		    </div>
              		  </div>
            		  </div>
            		  <div id="pivot-table-placeholder-parent">
                    <div id="pivot-table"></div>
                  </div>
          	    </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bottom-cap" ></div>
      </div>
      <div class="bottom">
        <div id="contact-strip">
          <div id="contact-center">
            <div class="phone-number">
              <span class="white">1-</span><span class="green">800</span><span class="white">-553-</span><span class="green">6341</span>
            </div>
            <img id="facebook-button" class="clickable" src="images/followusfacebook.png" /> 
            <img id="twitter-button" class="clickable" src="images/followustwitter.png" />
          </div>
        </div>
        <!--
        <div class="bottom-center">
          <div class="left">
          </div>
          <div class="right">
            <div id="quote-background">
              <p class="text">dolor lorem ipsum </p>
              <p class="name">John Green, founder <a href="http://www.trackoftheday.com" target="_blank">trackoftheday.com</a></p>
            </div>
          </div>
        </div>
        -->
        <div id="footer">
          <div class="center">
            <div class="left">
              <span><a href="privacy-policy.doc" target="_blank">privacy policy</a> - <a href="terms-of-use.doc" target="_blank">terms of use</a></span>
            </div>
            <div class="right">
              <span>Copyright 2010-2011 ReportGrid - All Rights Reserved</span>
            </div>
          </div>
        </div>
      </div>
      <div id="preloader"></div>
    </div>
    
    <script type="text/javascript">
    var random = function(n) {
          return Math.round(Math.random() * n);
        },
        count = random(3),
        carriers = ["Verizon", "ATT", "Sprint"],
        platform = ["BlackBerry", "IPhone", "Droid"],
        audience = ["retargetingList01", "retargetingList02", "addedValue"],
        cmp = [100, 120, 200],
        displayContext = ["website"],
        cType = ["email", "purchase", "membership"]
        timestamp = function() { var toggle = random(1);  return toggle < .5 ? new Date().getTime() - random(48 * 60 * 60 * (1000 * count )) : new Date().getTime() + random(48 * 60 * 60 * 1000)}
        doXTimes = function(x, f) {
          for (var i = 0; i < x; i++) {
            f();
          }
        },
        sendRandomImpressionEvent = function() {
          ReportGrid.track(
            "/adv",
            {
              "count": count,
              "timestamp": timestamp(),
              "events":{
                "impression": {
                  "carrier": carriers[random(3) - 1],
                  "platform":platform[random(3) - 1],
                  "audience":audience[random(3) - 1],
                  "displayContext": displayContext[0]
                }
              }
            }
          )
        },
        sendRandomConversionEvent = function() {
          ReportGrid.track(
            "/adv",
            {
              "count": random(3),
              "timestamp": timestamp(),
              "events":{
                "conversion": {
                  "conversionType": cType[random(3) - 1],
                  "platform":platform[random(3) - 1],
                  "audience":audience[random(3) - 1],
                  "displayContext": displayContext[0]
                }
              }
            }
          )
        };
        
    $("#send-random-data").click(function() {
      doXTimes(10, sendRandomImpressionEvent);
      doXTimes(1, sendRandomConversionEvent)
    });
    $('img.rollover').hover(
      function(e) { this.setAttribute('src', this.getAttribute('src').replace('reg', 'sel')); },
      function(e) { this.setAttribute('src', this.getAttribute('src').replace('sel', 'reg')); }
    );
    $("#facebook-button").click(function() {window.open("http://www.facebook.com/pages/ReportGrid/155235737848809?v=wall"); });
    $("#twitter-button").click(function() {window.open("http://twitter.com/#!/ReportGrid"); });
    
    function preload(a) {
      
      for (i=0; i < a.length; i++) {
        var e = document.createElement("img");
        e.setAttribute('src', a[i]);
        document.getElementById('preloader').appendChild(e);
      }
    }
    
    function preloadAllImages() {
      var images = document.getElementsByTagName('img');
      var imageSources = new Array();

      for (i=0; i < images.length; i++) {
        imageSources.push(images[i].getAttribute('src'));
      }
      preload(imageSources.concat(['images/featuressel.png', 'images/apisel.png','images/aboutsel.png', 'images/loginbuttonsel.png', 'images/getstartedroundsel.png', 'images/whysel.png', 'images/pricingsel.png', 'images/getstartedrecsel.png', 'images/demosel.png', "images/overviewbuttonsel.png", "images/analyzebuttonsel.png", "images/visualizebuttonsel.png", "images/delightbuttonsel.png"]));
    }
    preloadAllImages();
    
    // Pivot Table Dashboard
    
    function attachPivotTableToHTML(tableId, pathInputId, submitButtonId, eventSelectorId, rowSelectorId, colSelectorId, propertySelectorsClass) {
      var input   			      = $(pathInputId);
      var button  			      = $(submitButtonId);
      var eventSelector 	    = $(eventSelectorId);
      var rowSelector   	    = $(rowSelectorId);
      var columnSelector   	  = $(colSelectorId);
      var propertySelectors   = $(propertySelectorsClass);
      var eventSelection      = null;
      var colSelection        = null;
      var rowSelection        = null;
      var availProperties     = [];

      function resetOptions(elem) {
      	elem.html("<option>select</option>");
      }

      function addOption(optEl, value) {
      	optEl.append($("<option class='option-" + toClassName(value) + "'>" + noDot(value) + "</option>"));
      }

      function fillOptions(options, elem) {
      	resetOptions(elem);
        $.each(options, function (index, value) {
        	addOption(elem, value);
        });
      }
      function propertyUnavailable(s) {
      	var result = [];
      	$.each(availProperties, function(index, value) {
      	  if (s != value) result.push(value);	
  	    });
  	    return result;
      }
      function checkIfFieldHasProperties(f) {
      	ReportGrid.children(input.val(), { "type" : "field", "field" : eventSelection + f }, function(e) { 
      	  if (e.length > 0) { 
      	  	fillOptions(propertyUnavailable(f), rowSelector); 
      	  	fillOptions(propertyUnavailable(f), columnSelector);
      	  	addOption(eventSelector, eventSelection +  f); 
      	  	availProperties = propertyUnavailable(f);
  	  	  }	
  	    });
      }
      
      eventSelector.change(function () {
        $(toSelectorString(eventSelectorId)).each(function () {
        	eventSelection = withDot($(this).text());
        	
            ReportGrid.children(input.val(), { "type" : "field", "field" : eventSelection }, function(e) {
              availProperties = e;
           	  fillOptions(e, propertySelectors); 
           	  $.each(e, function(index, value) {checkIfFieldHasProperties(value); });
           	});
        });
      })
      rowSelector.change(function () {
        $(toSelectorString(rowSelectorId)).each(function () {
        	rowSelection = withDot($(this).text());
        	fillOptions(propertyUnavailable(rowSelection), columnSelector);

        	generatePivotTable();
        });
      })
      columnSelector.change(function () {
        $(toSelectorString(colSelectorId)).each(function () {
        	colSelection = withDot($(this).text());
        	fillOptions(propertyUnavailable(colSelection), rowSelector);
        	generatePivotTable();
        });
      })
      function toSelectorString(selector) {
        return  selector + " option:selected";
      }
      function generatePivotTable() {
      	if (rowSelection  && colSelection) {
      		document.getElementById(tableId).innerHTML = "";
      		new ReportGrid.pivotTable(tableId, input.val(), { rows : eventSelection + rowSelection, columns : eventSelection + colSelection });
      		fillOptions(availProperties, propertySelectors)
      		rowSelection = null; colSelection = null;
      	}
      }
      button.click(function() { ReportGrid.children(input.val(), { "type" : "all" }, function(e) {
        fillOptions(e, eventSelector); }); 
      });
      function withDot(s) {
        return "." + s;
      }
      function toClassName(s) {
        return String(s).replace(/./gi, "");
      }
      function noDot(s) {
        return String(s).replace(".", "");
      }
    }
    attachPivotTableToHTML("pivot-table", "#path-input", "#get-properties-button", "#event-selector", "#row-selector", "#column-selector", ".property-selector")
    
    </script>
    
  </body>
</html>
